<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name=author content="Made Indra">

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
<link rel="shortcut icon" href="/assets/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="192x192" href="/assets/favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/assets/favicon/android-chrome-512x512.png">


  <title>Money Data Type in Golang | madeindra.dev</title>
  <meta name="description"
    content="Learn how to handle money data type in Golang without floating-point arithmetic errors using custom type definition and JSON interface implementation.">
  <meta name="keywords"
    content="Golang, Money, Floating, Decimal">

  <link rel="canonical" href="https://madeindra.dev/money-data-type-in-golang/">
  <link rel="alternate" type="application/rss+xml" title="madeindra.dev" href="https://madeindra.dev/feed.xml" />

  <!-- for browsers supporting theme-color -->
  <meta name="theme-color" content="">

  <meta property="og:title" content="Money Data Type in Golang">
<meta property="og:description"
    content="Learn how to handle money data type in Golang without floating-point arithmetic errors using custom type definition and JSON interface implementation.">
<meta property="og:url" content="https://madeindra.dev/money-data-type-in-golang/">
<meta property="og:site_name" content="madeindra.dev">
<meta property="og:type" content="website">

<meta property="og:image" content="https://madeindra.dev/assets/images/2024-12-09-money-data-type-in-golang.webp">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Money Data Type in Golang">
<meta name="twitter:description"
    content="Learn how to handle money data type in Golang without floating-point arithmetic errors using custom type definition and JSON interface implementation.">

<meta property="twitter:domain" content="https://madeindra.dev">
<meta property="twitter:url"
    content="https://madeindra.dev/money-data-type-in-golang/">
<meta name="twitter:image" content="https://madeindra.dev/assets/images/2024-12-09-money-data-type-in-golang.webp">


<meta name="twitter:site" content="@madecanggih">


  <link rel="stylesheet" href="/assets/css/main.css">
</head>

<body
  class="min-h-screen flex flex-col transition-colors duration-300 bg-white dark:bg-dark text-gray-900 dark:text-dark-base">
  <header class="py-6">
  <div class="container mx-auto px-4 flex justify-between items-center">
    <!-- Logo and Title -->
    <div class="flex items-center">
      
      <a href="/">
        <img src="https://madeindra.dev/assets/images/logo.webp" alt="Logo" class="h-8 mr-2 block md:hidden" />
      </a>
      
      <h1 class="text-xl font-semibold hidden md:block">
        <a href="/" class="hover:text-gray-600 dark:hover:text-white">
          madeindra.dev
        </a>
      </h1>
    </div>

    <!-- Search Bar-->
    
    <div id="search-bar" class="relative w-1/3">
      <input type="text" id="search-input" placeholder="Search..."
        class="w-full px-4 py-1 border rounded-full focus:outline-none focus:ring-0 bg-white dark:bg-dark transition-colors duration-300">
      <div id="search-results" class="z-[100] absolute left-0 right-0 mt-2 bg-white dark:bg-dark border rounded shadow-lg hidden"
        style="min-width: 150%; left: 50%; transform: translateX(-50%);"></div>
    </div>
    

    <!-- Navigation -->
    <div class="flex items-center space-x-4">
      
      <!-- Desktop Navigation -->
      <nav class="hidden md:block">
        <ul class="flex space-x-6 font-normal">
          
          <li><a href="/" class="hover:text-gray-600 dark:hover:text-white">Home</a></li>
          

          
          <li><a href="/about" class="hover:text-gray-600 dark:hover:text-white">About</a></li>
          
        </ul>
      </nav>

      <!-- Burger Menu Icon -->
      <div class="relative">
        <button id="burger-menu" class="md:hidden p-2 rounded-full" aria-label="Toggle mobile menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>

        <!-- Mobile Menu (Positioned absolutely) -->
        <div id="mobile-menu" class="hidden md:hidden absolute mt-2 w-24 bg-white dark:bg-dark border rounded shadow-lg z-50">
          <nav>
            <ul class="py-2 font-normal">
              
              <li><a href="/" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Home</a></li>
              

              
              <li><a href="/about" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">About</a></li>
              
            </ul>
          </nav>
        </div>
      </div>

      <button id="theme-toggle" class="p-2 rounded-full" aria-label="Toggle theme to dark or light mode">
        <svg id="theme-toggle-dark-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke-width="0" stroke="currentColor" class="w-5 h-5 hidden" >
          <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
        </svg>
        
        <svg id="theme-toggle-light-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"  stroke-width="1.5" stroke="currentColor" class="w-5 h-5 hidden" >
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
        </svg>
      </button>

    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const burgerMenu = document.getElementById('burger-menu');
      const mobileMenu = document.getElementById('mobile-menu');

      burgerMenu.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });

      document.addEventListener('click', (event) => {
        if (!burgerMenu.contains(event.target) && !mobileMenu.contains(event.target)) {
          mobileMenu.classList.add('hidden');
        }
      });
    });
  </script>
</header>

<main class="container mx-auto px-4 flex-grow">

    <div class="relative max-w-prose mb-6 mx-auto">
        <!-- Featured Image -->
        
        <div class="relative overflow-hidden rounded">
            
            <img src="https://madeindra.dev/assets/images/2024-12-09-money-data-type-in-golang.webp" alt="Featured image" class="w-full h-[40vh] md:h-[50vh] object-cover">
            

            <!-- Black Overlay -->
            <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        </div>
        


        <!-- Title Overlay -->
        <div
            class="absolute bottom-0 left-0 right-0 p-6 text-white">
            <div class="flex items-center space-x-1 md:space-x-2 text-sm mb-2">
                <span>09 Dec 2024</span>
                <span>•</span>
                <span>13 min read</span>
                <span>•</span>
                <span
                    class="">
                    Development
                </span>
            </div>
            <h1 class="text-2xl md:text-4xl font-bold">Money Data Type in Golang</h1>
        </div>
    </div>

    <article class="prose dark:prose-invert prose-img:mx-auto max-w-prose mx-auto space-y-6 sm:text-lg leading-relaxed">
        <p>It’s common knowledge that using <code class="language-plaintext highlighter-rouge">Float</code> (or <code class="language-plaintext highlighter-rouge">Number</code> in JavaScript, which is <code class="language-plaintext highlighter-rouge">Float64</code> behind the scenes) to store monetary data is a bad idea. If you don’t know this yet, try doing <code class="language-plaintext highlighter-rouge">10 / 3</code> in your choice of programming language. I’ve seen a lot of LinkedIn posts ridiculing JavaScript for this.</p>

<p><img src="/assets/others/floating-point-error-1.webp" alt="Dividing 10 by 3" /></p>

<p>When dealing with a user’s balance, let’s say in US Dollars, we sometimes need to deal with cent values. If a user has a balance of US$10.00 and we want to charge them 50 cents (US$0.50), they will have US$9.50 by the end of it. Doesn’t look wrong, right?</p>

<p>But what if the user only has US$1.00 and we charge them 70 cents (US$0.70)?</p>

<p><img src="/assets/others/floating-point-error-2.webp" alt="Subtracting 0.70 from 1.00" /></p>

<p>Mentally we already did the calculation and got US$0.30, but again when I tried the code in JavaScript, I got <code class="language-plaintext highlighter-rouge">0.30000000000000004</code>. Now the customer has more money than they should have.</p>

<blockquote>
  <p>Huh, weird?</p>

  <p>That couldn’t be right. Curse you JavaScript!</p>
</blockquote>

<p>I mean, this problem can be found not only in JavaScript but also in all programming languages that use the <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a> standard. So Golang has this problem too, run <a href="https://go.dev/play/p/WE25YQNwOZ5">this piece of code</a> if you don’t believe me.</p>

<h2 id="dealing-with-decimal-places">Dealing with Decimal Places</h2>

<blockquote>
  <p>So what should we use, then?</p>
</blockquote>

<p>Worry not! We have other data types.</p>

<p>Throughout my career, I’ve seen there are two ways most developers handle this; either by using <code class="language-plaintext highlighter-rouge">Integer</code> or <code class="language-plaintext highlighter-rouge">String</code>.</p>

<p>When using <code class="language-plaintext highlighter-rouge">Integer</code>, we write US$1 as <code class="language-plaintext highlighter-rouge">100</code>. Notice that there is no comma separator in the value. This way every calculation can be done in <code class="language-plaintext highlighter-rouge">Integer</code>, no more floating-point issues. This way, we will show <code class="language-plaintext highlighter-rouge">100</code> in API request/response and database to denote US$1.</p>

<p>When using <code class="language-plaintext highlighter-rouge">String</code>, we write US$1 as <code class="language-plaintext highlighter-rouge">"1.00"</code>, then we parse it to <code class="language-plaintext highlighter-rouge">Integer</code> so we get a value like the previous example, do some calculation, and make it into <code class="language-plaintext highlighter-rouge">String</code> again to be stored in the database. This way we can show <code class="language-plaintext highlighter-rouge">"1.00"</code> in the API request/response while calculating them fully in <code class="language-plaintext highlighter-rouge">Integer</code>.</p>

<p>To be honest, I am a bit opinionated on this money-data-type approach.</p>

<p>I think the <code class="language-plaintext highlighter-rouge">Integer</code> approach is great since there is no extra step necessary for parsing value, but the downside is the API consumer has to be aware that <code class="language-plaintext highlighter-rouge">100</code> means <code class="language-plaintext highlighter-rouge">US$1</code> and not <code class="language-plaintext highlighter-rouge">US$100</code>.</p>

<p>If you worked in backend, you know how silly it is to trust that the API consumer would have the same thought process as the API developer.</p>

<p>Personally, I liked the second approach where the API consumer can just pass <code class="language-plaintext highlighter-rouge">String</code> value of either <code class="language-plaintext highlighter-rouge">"1"</code> or <code class="language-plaintext highlighter-rouge">"1.00"</code> and we would still get the same <code class="language-plaintext highlighter-rouge">Integer</code> value of <code class="language-plaintext highlighter-rouge">100</code> to handle. But, I would store them as <code class="language-plaintext highlighter-rouge">Integer</code> not <code class="language-plaintext highlighter-rouge">String</code> so that parsing only happened when receiving request or before sending response.</p>

<h2 id="enter-the-json-interface">Enter the JSON Interface</h2>

<p>I would use JSON for most of my API, this is the format most consumers expect to get.</p>

<p>In Go, there are JSON interface methods that we can override to customize the behavior when receiving requests and sending responses. We will use this to eliminate the need to manually call the <code class="language-plaintext highlighter-rouge">String</code> to <code class="language-plaintext highlighter-rouge">Integer</code> parsing method every time.</p>

<h3 id="determining-the-number-of-decimal-places">Determining The Number of Decimal Places</h3>

<p>Before we start, let’s talk a little bit about currency.</p>

<p>Most countries use 2 decimal places. There’s a country like Kuwait that uses 3 decimal places. And there are countries like Indonesia and Japan that use no decimal places at all. I haven’t found any country that uses more than 3 decimal places, yet.</p>

<p>Being ambitious, let’s say we want to support all currencies from every country in the world. Standardizing 3 decimal places on the backend would be great. On the frontend we don’t need to care; <code class="language-plaintext highlighter-rouge">"1"</code>, <code class="language-plaintext highlighter-rouge">"1.0"</code>, <code class="language-plaintext highlighter-rouge">"1.00"</code> or <code class="language-plaintext highlighter-rouge">"1.000"</code> will all be treated as <code class="language-plaintext highlighter-rouge">"1.000"</code>. Less stress for the API consumers, less conflict we will have. LOL!</p>

<h3 id="overriding-json-marshalunmarshal">Overriding JSON Marshal/Unmarshal</h3>

<p>Now that we have agreed to use 3 decimal places for all money data, let’s start by coding the implementation.</p>

<p>This is our starting point, just like all other Go Projects:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>First, let’s create a custom data type:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Money</span> <span class="kt">int64</span>
</code></pre></div></div>

<p>Notice that we didn’t write it as <code class="language-plaintext highlighter-rouge">type Money = int64</code>, because this is Type Definition, not Type Alias.</p>

<p>The difference is when doing Aliasing, both data type are interchangeable, meaning we can pass <code class="language-plaintext highlighter-rouge">int64</code> to functions that expect <code class="language-plaintext highlighter-rouge">Money</code> if it were alias of <code class="language-plaintext highlighter-rouge">int64</code>. But, in Type Definition, we need to explicitly cast <code class="language-plaintext highlighter-rouge">int64</code> to <code class="language-plaintext highlighter-rouge">Money</code> before we can pass it to functions that expect <code class="language-plaintext highlighter-rouge">Money</code>.</p>

<p>Now that we have our custom data type, let’s add 2 methods to change the way we receive JSON request and send JSON response:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// UnmarshalJSON implements the json.Unmarshaler interface</span>
<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">Money</span><span class="p">)</span> <span class="n">UnmarshalJSON</span><span class="p">(</span><span class="n">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="c">// remove quotes from string</span>
	<span class="n">s</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Trim</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">)</span>

	<span class="c">// if negative, remove sign</span>
	<span class="n">isNegative</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">isNegative</span> <span class="p">{</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">]</span>
	<span class="p">}</span>

	<span class="c">// split by point</span>
	<span class="n">parts</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"."</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">2</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid decimal format: %s"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// parse leading part</span>
	<span class="n">intPart</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="m">10</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid integer part: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// multiply by 1000, later will add the trailing part</span>
	<span class="n">result</span> <span class="o">:=</span> <span class="n">intPart</span> <span class="o">*</span> <span class="m">1000</span>

	<span class="c">// parse trailing part, only if exist</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="m">2</span> <span class="p">{</span>
		<span class="c">// trim to at max 3 digits (additional decimal places will be ignored)</span>
		<span class="n">decimalPart</span> <span class="o">:=</span> <span class="n">parts</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">decimalPart</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">3</span> <span class="p">{</span>
			<span class="n">decimalPart</span> <span class="o">=</span> <span class="n">decimalPart</span><span class="p">[</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
		<span class="p">}</span>

		<span class="c">// pad with additional zeros (if less than 3 decimal places)</span>
		<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="n">decimalPart</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">3</span> <span class="p">{</span>
			<span class="n">decimalPart</span> <span class="o">+=</span> <span class="s">"0"</span>
		<span class="p">}</span>

		<span class="c">// parse</span>
		<span class="n">decimal</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">decimalPart</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid decimal part: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="c">// combine leading and trailing part</span>
		<span class="n">result</span> <span class="o">+=</span> <span class="n">decimal</span>
	<span class="p">}</span>

	<span class="c">// if negative, return back sign</span>
	<span class="k">if</span> <span class="n">isNegative</span> <span class="p">{</span>
		<span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

	<span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="c">// MarshalJSON implements the json.Marshaler interface</span>
<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="n">Money</span><span class="p">)</span> <span class="n">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// get non-negative value</span>
	<span class="n">value</span> <span class="o">:=</span> <span class="kt">int64</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
	<span class="n">sign</span> <span class="o">:=</span> <span class="s">""</span>
	<span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">sign</span> <span class="o">=</span> <span class="s">"-"</span>
		<span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span>
	<span class="p">}</span>

	<span class="c">// calculate leading and trailing digits</span>
	<span class="n">intPart</span> <span class="o">:=</span> <span class="n">value</span> <span class="o">/</span> <span class="m">1000</span>
	<span class="n">decPart</span> <span class="o">:=</span> <span class="n">value</span> <span class="o">%</span> <span class="m">1000</span>

	<span class="c">// always format to trailing 3 decimal</span>
	<span class="n">str</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%s%d.%03d"</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">intPart</span><span class="p">,</span> <span class="n">decPart</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For request/response simulation, we will need a struct that has <code class="language-plaintext highlighter-rouge">Money</code> data type as the property:</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Data</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Value</span> <span class="n">Money</span> <span class="s">`json:"value"`</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now to simulate receiving request:</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// receiving request</span>
<span class="n">incoming</span> <span class="o">:=</span> <span class="s">`{"value": "1"}`</span>

<span class="k">var</span> <span class="n">received</span> <span class="n">Data</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">incoming</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">received</span><span class="p">)</span>

<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"incoming data parsed as int64:"</span><span class="p">,</span> <span class="n">received</span><span class="p">)</span>
</code></pre></div></div>

<p>The result will look like this:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>incoming data parsed as int64: <span class="o">{</span>1000<span class="o">}</span>
</code></pre></div></div>

<p>Whatever value being sent, be it <code class="language-plaintext highlighter-rouge">"1"</code>, <code class="language-plaintext highlighter-rouge">"1.0"</code>, <code class="language-plaintext highlighter-rouge">"1.00"</code> or <code class="language-plaintext highlighter-rouge">"1.000"</code>, the backend will receive it as <code class="language-plaintext highlighter-rouge">1000</code>. Neat, huh?</p>

<p>Now to simulate sending response:</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// sending response</span>
<span class="n">outgoing</span> <span class="o">:=</span> <span class="n">Data</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="m">5000</span><span class="p">}</span>
<span class="n">sent</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">outgoing</span><span class="p">)</span>

<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"outgoing data converted to string:"</span><span class="p">,</span> <span class="kt">string</span><span class="p">(</span><span class="n">sent</span><span class="p">))</span>
</code></pre></div></div>

<p>The result will look like this:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>outgoing data converted to string: <span class="o">{</span><span class="s2">"value"</span>:<span class="s2">"5.000"</span><span class="o">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Money</code> data type will be automatically converted to string. Perfect!</p>

<h3 id="putting-them-up">Putting Them Up</h3>

<p>The final result should looks like this:</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"encoding/json"</span>
	<span class="s">"fmt"</span>
	<span class="s">"strconv"</span>
	<span class="s">"strings"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">Money</span> <span class="kt">int64</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">Money</span><span class="p">)</span> <span class="n">UnmarshalJSON</span><span class="p">(</span><span class="n">data</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="c">// remove quotes from string</span>
	<span class="n">s</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Trim</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">)</span>

	<span class="c">// if negative, remove sign</span>
	<span class="n">isNegative</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">isNegative</span> <span class="p">{</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">]</span>
	<span class="p">}</span>

	<span class="c">// split by point</span>
	<span class="n">parts</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">"."</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">2</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid decimal format: %s"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// parse leading part</span>
	<span class="n">intPart</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="m">10</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid integer part: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// multiply by 1000, later will add the trailing part</span>
	<span class="n">result</span> <span class="o">:=</span> <span class="n">intPart</span> <span class="o">*</span> <span class="m">1000</span>

	<span class="c">// parse trailing part, only if exist</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="m">2</span> <span class="p">{</span>
		<span class="c">// trim to at max 3 digits (additional decimal places will be ignored)</span>
		<span class="n">decimalPart</span> <span class="o">:=</span> <span class="n">parts</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">decimalPart</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">3</span> <span class="p">{</span>
			<span class="n">decimalPart</span> <span class="o">=</span> <span class="n">decimalPart</span><span class="p">[</span><span class="o">:</span><span class="m">3</span><span class="p">]</span>
		<span class="p">}</span>

		<span class="c">// pad with additional zeros (if less than 3 decimal places)</span>
		<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="n">decimalPart</span><span class="p">)</span> <span class="o">&lt;</span> <span class="m">3</span> <span class="p">{</span>
			<span class="n">decimalPart</span> <span class="o">+=</span> <span class="s">"0"</span>
		<span class="p">}</span>

		<span class="c">// parse</span>
		<span class="n">decimal</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">decimalPart</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid decimal part: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="c">// combine leading and trailing part</span>
		<span class="n">result</span> <span class="o">+=</span> <span class="n">decimal</span>
	<span class="p">}</span>

	<span class="c">// if negative, return back sign</span>
	<span class="k">if</span> <span class="n">isNegative</span> <span class="p">{</span>
		<span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

	<span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="c">// MarshalJSON implements the json.Marshaler interface</span>
<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="n">Money</span><span class="p">)</span> <span class="n">MarshalJSON</span><span class="p">()</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// get non-negative value</span>
	<span class="n">value</span> <span class="o">:=</span> <span class="kt">int64</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
	<span class="n">sign</span> <span class="o">:=</span> <span class="s">""</span>
	<span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">sign</span> <span class="o">=</span> <span class="s">"-"</span>
		<span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span>
	<span class="p">}</span>

	<span class="c">// calculate leading and trailing digits</span>
	<span class="n">intPart</span> <span class="o">:=</span> <span class="n">value</span> <span class="o">/</span> <span class="m">1000</span>
	<span class="n">decPart</span> <span class="o">:=</span> <span class="n">value</span> <span class="o">%</span> <span class="m">1000</span>

	<span class="c">// always format to trailing 3 decimal</span>
	<span class="n">str</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%s%d.%03d"</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">intPart</span><span class="p">,</span> <span class="n">decPart</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Data</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Value</span> <span class="n">Money</span> <span class="s">`json:"value"`</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c">// receiving request</span>
	<span class="n">incoming</span> <span class="o">:=</span> <span class="s">`{"value": "1"}`</span>

	<span class="k">var</span> <span class="n">received</span> <span class="n">Data</span>
	<span class="n">_</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">incoming</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">received</span><span class="p">)</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"incoming data parsed as int64:"</span><span class="p">,</span> <span class="n">received</span><span class="p">)</span>

	<span class="c">// sending response</span>
	<span class="n">outgoing</span> <span class="o">:=</span> <span class="n">Data</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="m">5000</span><span class="p">}</span>
	<span class="n">sent</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">outgoing</span><span class="p">)</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"outgoing data converted to string:"</span><span class="p">,</span> <span class="kt">string</span><span class="p">(</span><span class="n">sent</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="closing-up">Closing Up</h2>

<p>Now you know (arguably) the best way to handle money data in Golang.</p>

<p>Joke aside, this approach is not the perfect (yet), for production you might want to add more handling such as arithmetic operations, validation rules, and formatting with currency.</p>

<p>But, so far, using this approach, you already get:</p>
<ul>
  <li>Consistent decimal places handling</li>
  <li>Clean API request/response with string representation</li>
  <li>No floating-point arithmetic errors</li>
</ul>

<p>I’d say that’s already enough for a starter (๑˃ᴗ˂)ﻭ</p>

<hr />

<p>Photo by <a href="https://unsplash.com/@nbmat?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Mathieu Turle on Unsplash</a></p>


    </article>

    
    <div class="max-w-prose mx-auto border-t border-gray-200 my-12"></div>
    <section class="max-w-prose mx-auto">
        <script src="https://giscus.app/client.js"
        data-repo="madeindra/madeindra.github.io"
        data-repo-id="R_kgDOMxraRQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOMxraRc4CjK1D"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        id="gitcus"
        async>
</script>
    </section>
    
</main>

<footer class="py-6">
    <div class="container mx-auto px-4">
        <!-- Divider -->
        <div class="border-t border-gray-200 mb-4"></div>

        <!-- Footer -->
        <div class="flex justify-between items-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">
                madeindra.dev © 2025
            </div>
            
            <div class="text-sm text-gray-600 dark:text-gray-400">
                
                <a href="/sitemap.xml" class="hover:text-gray-900 dark:hover:text-gray-100">Sitemap</a>
                
        
                
                <span class="px-2">|</span>
                
        
                
                <a href="/feed.xml" class="hover:text-gray-900 dark:hover:text-gray-100">RSS</a>
                
            </div>
        </div>
    </div>
</footer>

  <script type="text/javascript">
    const themeToggleBtn = document.getElementById('theme-toggle');
    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

    const themeColorMetaTag = document.querySelector('meta[name="theme-color"]');

    const themeComment = document.getElementById('gitcus');

    // add click listener to theme toggle button
    themeToggleBtn?.addEventListener('click', function () {
        setTheme(!document?.documentElement?.classList?.contains('dark'));
    });

    // set initial theme
    if (sessionStorage.theme === 'dark' || (!('theme' in sessionStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        setTheme(true);
    } else {
        setTheme(false);
    }

    function setTheme(isDark) {
        if (isDark) {
            sessionStorage.theme = 'dark';

            document.documentElement?.classList?.add('dark');

            themeToggleDarkIcon?.classList?.add('hidden');
            themeToggleLightIcon?.classList?.remove('hidden');

            themeColorMetaTag.setAttribute('content', '#1A1A1A');

            if (themeComment) {
                themeComment.setAttribute('data-theme', 'noborder_dark');
            }
        } else {
            sessionStorage.theme = 'light';

            document.documentElement?.classList?.remove('dark');

            themeToggleDarkIcon?.classList?.remove('hidden');
            themeToggleLightIcon?.classList?.add('hidden');

            themeColorMetaTag.setAttribute('content', '#FFFFFF');

            if (themeComment) {
                themeComment.setAttribute('data-theme', 'noborder_light');
            }
        }
    }
</script>

  
  <script type="text/javascript">
  let searchData = [];

  // Fetch search data
  fetch('/search.json')
    .then(response => response.json())
    .then(data => {
      searchData = data;
    });

  const searchBar = document.getElementById('search-bar');
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  searchInput?.addEventListener('input', debounce(handleSearch, 300));

  function setResultInnerHTML(content) {
    searchResults.innerHTML = content;
  }

  function addResultClass(className) {
    searchResults.classList.add(className);
  }

  function removeResultClass(className) {
    searchResults.classList.remove(className);
  }

  function handleSearch() {
    const query = searchInput.value.toLowerCase();

    // don't process 1 character
    if (query.length < 2) {
      setResultInnerHTML('');
      addResultClass('hidden');

      return;
    }

    const matches = searchData
      .map(item => ({
        item,
        score: fuzzyMatch(query, item.title.toLowerCase())
      }))
      .filter(({ score }) => score > 0.3)
      .sort((a, b) => b.score - a.score)
      .slice(0, 5);

    renderResults(matches);
  }

  function fuzzyMatch(query, text) {
    let score = 0;
    let textIndex = 0;

    for (let i = 0; i < query.length; i++) {
      const index = text.indexOf(query[i], textIndex);
      if (index === -1) return 0;
      score += 1 / (index - textIndex + 1);
      textIndex = index + 1;
    }

    return score / query.length;
  }

  function renderResults(matches) {
    let resultInnerHTML;
    if (matches.length === 0) {
      resultInnerHTML = '<p class="p-2 text-gray-500 dark:text-gray-500">No results found</p>';
    } else {
      resultInnerHTML = matches
        .map(({ item }) => `
            <a href="${item.url}" class="block p-2 hover:bg-gray-200 dark:hover:bg-gray-800">
              <h3 class="font-semibold">${item.title}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">${item.description}</p>
            </a>
          `)
        .join('');
    }

    setResultInnerHTML(resultInnerHTML);
    removeResultClass('hidden');
  }

  function debounce(func, delay) {
    let timeoutId;
    return function (...args) {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
  }

  // hide search results on click
  document?.addEventListener('click', (event) => {
    if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
      searchResults.classList.add('hidden');
    }
  });
</script>
  
</body>

</html>