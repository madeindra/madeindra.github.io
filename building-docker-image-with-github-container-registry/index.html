<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name=author content="Made Indra">

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
<link rel="shortcut icon" href="/assets/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="192x192" href="/assets/favicon/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/assets/favicon/android-chrome-512x512.png">


  <title>Building Docker Image with GitHub Container Registry | madeindra.dev</title>
  <meta name="description"
    content="Learn how to use GitHub Actions to build Docker images and store them in GitHub Container Registry (ghcr.io). A guide to improving CI/CD workflow for private...">
  <meta name="keywords"
    content="Docker, GitHub">

  <link rel="canonical" href="https://madeindra.dev/building-docker-image-with-github-container-registry/">
  <link rel="alternate" type="application/rss+xml" title="madeindra.dev" href="https://madeindra.dev/feed.xml" />

  <!-- for browsers supporting theme-color -->
  <meta name="theme-color" content="">

  <meta property="og:title" content="Building Docker Image with GitHub Container Registry">
<meta property="og:description"
    content="Learn how to use GitHub Actions to build Docker images and store them in GitHub Container Registry (ghcr.io). A guide to improving CI/CD workflow for private...">
<meta property="og:url" content="https://madeindra.dev/building-docker-image-with-github-container-registry/">
<meta property="og:site_name" content="madeindra.dev">
<meta property="og:type" content="website">

<meta property="og:image" content="https://madeindra.dev/assets/images/2024-12-08-building-docker-image-with-github-container-registry.webp">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Building Docker Image with GitHub Container Registry">
<meta name="twitter:description"
    content="Learn how to use GitHub Actions to build Docker images and store them in GitHub Container Registry (ghcr.io). A guide to improving CI/CD workflow for private...">

<meta property="twitter:domain" content="https://madeindra.dev">
<meta property="twitter:url"
    content="https://madeindra.dev/building-docker-image-with-github-container-registry/">
<meta name="twitter:image" content="https://madeindra.dev/assets/images/2024-12-08-building-docker-image-with-github-container-registry.webp">


<meta name="twitter:site" content="@madecanggih">


  <link rel="stylesheet" href="/assets/css/main.css">
</head>

<body
  class="min-h-screen flex flex-col transition-colors duration-300 bg-white dark:bg-dark text-gray-900 dark:text-dark-base">
  <header class="py-6">
  <div class="container mx-auto px-4 flex justify-between items-center">
    <!-- Logo and Title -->
    <div class="flex items-center">
      
      <a href="/">
        <img src="https://madeindra.dev/assets/images/logo.webp" alt="Logo" class="h-8 mr-2 block md:hidden" />
      </a>
      
      <h1 class="text-xl font-semibold hidden md:block">
        <a href="/" class="hover:text-gray-600 dark:hover:text-white">
          madeindra.dev
        </a>
      </h1>
    </div>

    <!-- Search Bar-->
    
    <div id="search-bar" class="relative w-1/3">
      <input type="text" id="search-input" placeholder="Search..."
        class="w-full px-4 py-1 border rounded-full focus:outline-none focus:ring-0 bg-white dark:bg-dark transition-colors duration-300">
      <div id="search-results" class="z-[100] absolute left-0 right-0 mt-2 bg-white dark:bg-dark border rounded shadow-lg hidden"
        style="min-width: 150%; left: 50%; transform: translateX(-50%);"></div>
    </div>
    

    <!-- Navigation -->
    <div class="flex items-center space-x-4">
      
      <!-- Desktop Navigation -->
      <nav class="hidden md:block">
        <ul class="flex space-x-6 font-normal">
          
          <li><a href="/" class="hover:text-gray-600 dark:hover:text-white">Home</a></li>
          

          
          <li><a href="/about" class="hover:text-gray-600 dark:hover:text-white">About</a></li>
          
        </ul>
      </nav>

      <!-- Burger Menu Icon -->
      <div class="relative">
        <button id="burger-menu" class="md:hidden p-2 rounded-full" aria-label="Toggle mobile menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>

        <!-- Mobile Menu (Positioned absolutely) -->
        <div id="mobile-menu" class="hidden md:hidden absolute mt-2 w-24 bg-white dark:bg-dark border rounded shadow-lg z-50">
          <nav>
            <ul class="py-2 font-normal">
              
              <li><a href="/" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">Home</a></li>
              

              
              <li><a href="/about" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">About</a></li>
              
            </ul>
          </nav>
        </div>
      </div>

      <button id="theme-toggle" class="p-2 rounded-full" aria-label="Toggle theme to dark or light mode">
        <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
        </svg>
        <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
            fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </button>

    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const burgerMenu = document.getElementById('burger-menu');
      const mobileMenu = document.getElementById('mobile-menu');

      burgerMenu.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });

      document.addEventListener('click', (event) => {
        if (!burgerMenu.contains(event.target) && !mobileMenu.contains(event.target)) {
          mobileMenu.classList.add('hidden');
        }
      });
    });
  </script>
</header>

<main class="container mx-auto px-4 flex-grow">

    <div class="relative max-w-prose mb-6 mx-auto">
        <!-- Featured Image -->
        
        <div class="relative overflow-hidden rounded">
            
            <img src="https://madeindra.dev/assets/images/2024-12-08-building-docker-image-with-github-container-registry.webp" alt="Featured image" class="w-full h-[40vh] md:h-[50vh] object-cover">
            

            <!-- Black Overlay -->
            <div class="absolute inset-0 bg-black bg-opacity-50"></div>
        </div>
        


        <!-- Title Overlay -->
        <div
            class="absolute bottom-0 left-0 right-0 p-6 text-white">
            <div class="flex items-center space-x-1 md:space-x-2 text-sm mb-2">
                <span>08 Dec 2024</span>
                <span>•</span>
                <span>6 min read</span>
                <span>•</span>
                <span
                    class="">
                    Project
                </span>
            </div>
            <h1 class="text-2xl md:text-4xl font-bold">Building Docker Image with GitHub Container Registry</h1>
        </div>
    </div>

    <article class="prose dark:prose-invert prose-img:mx-auto max-w-prose mx-auto space-y-6 sm:text-lg leading-relaxed">
        <p>Months ago I posted about using <a href="../shell-scripting-cicd">Shell Script for CI/CD</a> in a personal project in which the script includes cloning the repo locally, building the Docker image, and running it as a container right in the VPS. I know, I know. It’s not ideal, and it’s leaking the source code to the server, so let’s redo it.</p>

<p>I want to focus on using GitHub Actions on a private repository to build a Docker image and store it on GitHub Container Registry (<a href="https://ghcr.io/">ghcr.io</a>). It’s perfect for personal projects since we can use up to 500MB total for all images on the GitHub Free plan - it’s counted as GitHub Package storage usage, by the way.</p>

<p>What I am looking for in this round is:</p>
<ul>
  <li>Build the Docker image on GitHub Actions.</li>
  <li>Push the image into GitHub Container Registry.</li>
  <li>Pull the image into the server.</li>
  <li>Run a script to start the image as container on the server.</li>
</ul>

<p>Let’s take a look at how the action looks like.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">CI/CD Pipeline</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>

<span class="na">env</span><span class="pi">:</span>
  <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">${{ github.repository }}</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="c1"># this sets permission to read repo content and push image to ghcr.io</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">contents</span><span class="pi">:</span> <span class="s">read</span>
      <span class="na">packages</span><span class="pi">:</span> <span class="s">write</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="c1"># 1. Checkout the repository</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout repository</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="c1"># 2. Set up Go</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Go</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-go@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">go-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.22'</span>

      <span class="c1"># 3. Install dependencies</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">go get -v -t -d ./...</span>

      <span class="c1"># 4. Run Golang tests</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">go test -v ./...</span>
        
      <span class="c1"># 5. Login to ghcr.io</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to the container registry</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/login-action@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">registry</span><span class="pi">:</span> <span class="s">${{ env.REGISTRY }}</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">${{ github.actor }}</span>
          <span class="na">password</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
      
      <span class="c1"># 6. Extract metadata (tags, labels) for Docker</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Extract metadata</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">meta</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/metadata-action@v5</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">images</span><span class="pi">:</span> <span class="s">${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}</span>

      <span class="c1"># 7. Build and push image to ghcr.io</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push docker image</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">docker/build-push-action@v6</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
          <span class="na">push</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">tags</span><span class="pi">:</span> <span class="s">${{ steps.meta.outputs.tags }}</span>
          <span class="na">labels</span><span class="pi">:</span> <span class="s">${{ steps.meta.outputs.labels }}</span>
          <span class="c1"># you can pass build-args and secrets here</span>
          <span class="c1"># see https://github.com/marketplace/actions/build-and-push-docker-images</span>

  <span class="na">deploy</span><span class="pi">:</span>
    <span class="c1"># this prevent deployment when image building failed</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="c1"># 8. SSH to the server and run the script</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">executing remote ssh commands using password</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">appleboy/ssh-action@v1.2.0</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span> <span class="s">${{ secrets.HOST }}</span>
        <span class="na">username</span><span class="pi">:</span> <span class="s">${{ secrets.USERNAME }}</span>
        <span class="na">password</span><span class="pi">:</span> <span class="s">${{ secrets.PASSWORD }}</span>
        <span class="na">port</span><span class="pi">:</span> <span class="s">${{ secrets.PORT }}</span>
        <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s"># log in to container registry</span>
          <span class="s">echo "${{ secrets.GITHUB_TOKEN }}" | docker login ${{ env.REGISTRY }} -u ${{ github.actor }} --password-stdin</span>
          
          <span class="s"># pull the image</span>
          <span class="s">docker pull ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest</span>
          
          <span class="s"># export necessary environment variables for the script here</span>
          <span class="s"># export VARIABLE_NAME=value</span>

          <span class="s"># download and run deploy script using curl with auth header</span>
          <span class="s">curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \</span>
               <span class="s">-H "Accept: application/vnd.github.v3.raw" \</span>
               <span class="s">-o /vps/path/to/save/script_name.sh \</span>
               <span class="s">-L "https://api.github.com/repos/${{ github.repository }}/contents/repo/path/to/script_name.sh?ref=${{ github.sha }}"</span>

          <span class="s">chmod +x /vps/path/to/save/script_name.sh</span>
          <span class="s">/vps/path/to/save/script_name.sh</span>

          <span class="s"># remove script after run completed</span>
          <span class="s">rm -f /vps/path/to/save/script_name.sh</span>
</code></pre></div></div>

<p>With the above changes, no more cloning is needed to build images on the server.</p>

<p>All the build processes happen in the pipeline, and when it’s successfully built, the SSH script will log in to ghcr.io and pull the image. I chose to do Docker login before the script to prevent passing the <code class="language-plaintext highlighter-rouge">GITHUB_TOKEN</code> secret to the script.</p>

<blockquote>
  <p>P.S. <code class="language-plaintext highlighter-rouge">GITHUB_TOKEN</code> is a provided secret value.
No need to add them to the repository secret.</p>

  <p>The only thing I did was adding secrets for the ssh step.</p>
</blockquote>

<p>Only the script is downloaded into the server; the rest of the source code is not. This way, the script can be safely stored in the same repository. Moreover, it’s deleted from the server after the run is completed. Neat!</p>

<p>Just like the previous post, you can do anything inside the <code class="language-plaintext highlighter-rouge">script_name.sh</code>. The only difference would be that this time it would be simpler without the Docker build step:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="c"># Name for the Docker image</span>
<span class="nv">IMAGE_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">IMAGE_NAME</span><span class="k">:-</span><span class="nv">username</span><span class="p">/imagename</span>:latest<span class="k">}</span><span class="s2">"</span>
<span class="nv">CONTAINER_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">CONTAINER_NAME</span><span class="k">:-</span><span class="nv">containername</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># Check if a container with CONTAINER_NAME exists and stop/remove it</span>
<span class="nv">EXISTING_CONTAINER</span><span class="o">=</span><span class="si">$(</span>docker ps <span class="nt">-aq</span> <span class="nt">-f</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"</span><span class="nv">$CONTAINER_NAME</span><span class="s2">"</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$EXISTING_CONTAINER</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Stopping and removing existing container with name </span><span class="nv">$CONTAINER_NAME</span><span class="s2">..."</span>
    docker stop <span class="nv">$CONTAINER_NAME</span>
    docker <span class="nb">rm</span> <span class="nv">$CONTAINER_NAME</span>
<span class="k">fi</span>

<span class="c"># Run Docker container</span>
<span class="nb">echo</span> <span class="s2">"Running Docker container..."</span>
docker run <span class="nt">-d</span> <span class="nt">--restart</span> always <span class="nt">--name</span> <span class="nv">$CONTAINER_NAME</span> <span class="nv">$IMAGE_NAME</span>

<span class="nb">echo</span> <span class="s2">"Docker container started."</span>

</code></pre></div></div>

<p>Finally, you might be wondering whether GitHub has a dashboard for your images like what <a href="https://hub.docker.com/">DockerHub</a> does. Worry not! You can go to <a href="https://github.com/username?tab=packages">https://github.com/username?tab=packages</a> (change it to your username) to see a list of images you have stored in ghcr.io.</p>

    </article>

    
    <div class="max-w-prose mx-auto border-t border-gray-200 my-12"></div>
    <section class="max-w-prose mx-auto">
        <script src="https://giscus.app/client.js"
        data-repo="madeindra/madeindra.github.io"
        data-repo-id="R_kgDOMxraRQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOMxraRc4CjK1D"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        id="gitcus"
        async>
</script>
    </section>
    
</main>

<footer class="py-6">
    <div class="container mx-auto px-4">
        <!-- Divider -->
        <div class="border-t border-gray-200 mb-4"></div>

        <!-- Footer -->
        <div class="flex justify-between items-center">
            <div class="text-sm text-gray-600 dark:text-gray-400">
                madeindra.dev © 2024
            </div>
            
            <div class="text-sm text-gray-600 dark:text-gray-400">
                
                <a href="/sitemap.xml" class="hover:text-gray-900 dark:hover:text-gray-100">Sitemap</a>
                
        
                
                <span class="px-2">|</span>
                
        
                
                <a href="/feed.xml" class="hover:text-gray-900 dark:hover:text-gray-100">RSS</a>
                
            </div>
        </div>
    </div>
</footer>

  <script type="text/javascript">
    const themeToggleBtn = document.getElementById('theme-toggle');
    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

    const themeColorMetaTag = document.querySelector('meta[name="theme-color"]');

    const themeComment = document.getElementById('gitcus');

    // add click listener to theme toggle button
    themeToggleBtn?.addEventListener('click', function () {
        setTheme(!document?.documentElement?.classList?.contains('dark'));
    });

    // set initial theme
    if (sessionStorage.theme === 'dark' || (!('theme' in sessionStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        setTheme(true);
    } else {
        setTheme(false);
    }

    function setTheme(isDark) {
        if (isDark) {
            sessionStorage.theme = 'dark';

            document.documentElement?.classList?.add('dark');

            themeToggleDarkIcon?.classList?.add('hidden');
            themeToggleLightIcon?.classList?.remove('hidden');

            themeColorMetaTag.setAttribute('content', '#1A1A1A');

            if (themeComment) {
                themeComment.setAttribute('data-theme', 'noborder_dark');
            }
        } else {
            sessionStorage.theme = 'light';

            document.documentElement?.classList?.remove('dark');

            themeToggleDarkIcon?.classList?.remove('hidden');
            themeToggleLightIcon?.classList?.add('hidden');

            themeColorMetaTag.setAttribute('content', '#FFFFFF');

            if (themeComment) {
                themeComment.setAttribute('data-theme', 'noborder_light');
            }
        }
    }
</script>

  
  <script type="text/javascript">
  let searchData = [];

  // Fetch search data
  fetch('/search.json')
    .then(response => response.json())
    .then(data => {
      searchData = data;
    });

  const searchBar = document.getElementById('search-bar');
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  searchInput?.addEventListener('input', debounce(handleSearch, 300));

  function setResultInnerHTML(content) {
    searchResults.innerHTML = content;
  }

  function addResultClass(className) {
    searchResults.classList.add(className);
  }

  function removeResultClass(className) {
    searchResults.classList.remove(className);
  }

  function handleSearch() {
    const query = searchInput.value.toLowerCase();

    // don't process 1 character
    if (query.length < 2) {
      setResultInnerHTML('');
      addResultClass('hidden');

      return;
    }

    const matches = searchData
      .map(item => ({
        item,
        score: fuzzyMatch(query, item.title.toLowerCase())
      }))
      .filter(({ score }) => score > 0.3)
      .sort((a, b) => b.score - a.score)
      .slice(0, 5);

    renderResults(matches);
  }

  function fuzzyMatch(query, text) {
    let score = 0;
    let textIndex = 0;

    for (let i = 0; i < query.length; i++) {
      const index = text.indexOf(query[i], textIndex);
      if (index === -1) return 0;
      score += 1 / (index - textIndex + 1);
      textIndex = index + 1;
    }

    return score / query.length;
  }

  function renderResults(matches) {
    let resultInnerHTML;
    if (matches.length === 0) {
      resultInnerHTML = '<p class="p-2 text-gray-500 dark:text-gray-500">No results found</p>';
    } else {
      resultInnerHTML = matches
        .map(({ item }) => `
            <a href="${item.url}" class="block p-2 hover:bg-gray-200 dark:hover:bg-gray-800">
              <h3 class="font-semibold">${item.title}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">${item.description}</p>
            </a>
          `)
        .join('');
    }

    setResultInnerHTML(resultInnerHTML);
    removeResultClass('hidden');
  }

  function debounce(func, delay) {
    let timeoutId;
    return function (...args) {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
  }

  // hide search results on click
  document?.addEventListener('click', (event) => {
    if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
      searchResults.classList.add('hidden');
    }
  });
</script>
  
</body>

</html>